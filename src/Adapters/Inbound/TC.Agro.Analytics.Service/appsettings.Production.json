{
  "PathBase": null,
  "AllowedHosts": "*",
  "TimeZone": "America/Sao_Paulo",
  "Database": {
    "Postgres": {
      "Host": "${DB_HOST:localhost}",
      "Port": "${DB_PORT:5432}",
      "Database": "${DB_NAME:tc_agro_analytics}",
      "MaintenanceDatabase": "postgres",
      "UserName": "${DB_USER:postgres}",
      "Password": "${DB_PASSWORD:postgres}",
      "Schema": "public",
      "ConnectionTimeout": 30,
      "MinPoolSize": 5,
      "MaxPoolSize": 50,
      "SslMode": "Require",
      "TrustServerCertificate": false
    }
  },
  "Cache": {
    "Redis": {
      "Host": "${REDIS_HOST:redis}",
      "Port": "${REDIS_PORT:6379}",
      "Password": "${REDIS_PASSWORD:}"
    }
  },
  "Messaging": {
    "RabbitMQ": {
      "Host": "${RABBITMQ_HOST:rabbitmq}",
      "Port": "${RABBITMQ_PORT:5672}",
      "ManagementPort": 15672,
      "VirtualHost": "${RABBITMQ_VHOST:/}",
      "Exchange": "analytics.events",
      "UserName": "${RABBITMQ_USER:guest}",
      "Password": "${RABBITMQ_PASSWORD:guest}",
      "AutoProvision": true,
      "Durable": true,
      "UseQuorumQueues": true,
      "AutoPurgeOnStartup": false
    }
  },
  "Services": {
    "Identity": {
      "HttpPort": 5001
    },
    "Farm": {
      "HttpPort": 5002
    },
    "SensorIngest": {
      "HttpPort": 5003
    },
    "AnalyticsWorker": {
      "HttpPort": 5004
    },
    "Dashboard": {
      "HttpPort": 5005
    }
  },
  "Auth": {
    "Jwt": {
      "SecretKey": "${JWT_SECRET_KEY:CHANGE-THIS-IN-PRODUCTION-256-BIT-KEY-MINIMUM}",
      "Issuer": "tc-agro-identity-service",
      "Audience": [
        "tc-agro-analytics-worker"
      ]
    }
  },
  "Alerts": {
    "Thresholds": {
      "MaxTemperature": 35.0,
      "MinSoilMoisture": 20.0,
      "MinBatteryLevel": 15.0
    }
  },
  "Logging": {
    "LogLevel": {
      "Wolverine": "Information",
      "Default": "Information",
      "System.Net.Http.HttpClient": "Warning",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.EntityFrameworkCore": "Warning",
      "Microsoft.EntityFrameworkCore.Database.Command": "Warning",
      "Npgsql": "Warning"
    }
  },
  "Telemetry": {
    "Grafana": {
      "_comment": "Production: Grafana Agent via OTLP to centralized OTEL Collector",
      "Agent": {
        "Host": "${OTEL_COLLECTOR_HOST:otel-collector}",
        "OtlpGrpcPort": 4317,
        "OtlpHttpPort": 4318,
        "MetricsPort": 12345,
        "Enabled": true,
        "_comment": "Production: Enabled=true, use Kubernetes DNS names or service discovery"
      },
      "Otlp": {
        "Endpoint": "${OTEL_ENDPOINT:http://otel-collector:4318}",
        "Protocol": "http/protobuf",
        "Headers": "${OTEL_HEADERS:}",
        "TimeoutSeconds": 30,
        "Insecure": false,
        "_comment": "Production: Use HTTPS and proper authentication headers"
      }
    }
  },
  "Serilog": {
    "_comment": "Production: Serilog outputs to Console (JSON) and OpenTelemetry Collector. Logs are centralized in Loki via OTEL Collector.",
    "Using": [ "Serilog.Sinks.Console", "Serilog.Formatting.Compact", "Serilog.Sinks.OpenTelemetry" ],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning",
        "Microsoft.EntityFrameworkCore": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "formatter": "Serilog.Formatting.Compact.CompactJsonFormatter, Serilog.Formatting.Compact",
          "restrictedToMinimumLevel": "Information"
        }
      },
      {
        "Name": "OpenTelemetry",
        "Args": {
          "endpoint": "${OTEL_ENDPOINT:http://otel-collector:4318}/v1/logs",
          "protocol": "HttpProtobuf",
          "includeProperties": true,
          "includeFormattedMessage": true,
          "resourceAttributes": {
            "service.name": "tc-agro-analytics",
            "service.namespace": "tc-agro",
            "deployment.environment": "production"
          },
          "restrictedToMinimumLevel": "Information"
        }
      }
    ],
    "Enrich": [
      "FromLogContext",
      "WithMachineName",
      "WithThreadId"
    ]
  }
}
